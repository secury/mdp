<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>MDP 시각화</title>
    <style>
        body { margin: 0; background-color: #010409; color: #c9d1d9; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif; overflow: hidden; }
        canvas { display:block; width:100vw; height:100vh; }
        canvas { cursor: grab; }
        canvas:active { cursor: grabbing; }

        #toolbar button {
            background: #444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 30px;
        }
        #toolbar button:hover {
            background: #666;
        }
        #toolbar button.selected {
            background: #990;
        }

    </style>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@14.6.0/lib/browser/math.min.js"></script>
</head>
<body style="margin:0; overflow:hidden;">
    <div id="toolbar">
        <button id="btnQ">Q</button>
        <button id="btnFlow">Flow</button>
        &nbsp;
        &nbsp;
        <button id="btnR1" class="selected">Reward 1</button>
        <button id="btnR2">Reward 2</button>
        <button id="btnR3">Reward 3</button>
        &nbsp;
        &nbsp;
        <button id="btnUniform">Uniform</button>
        <button id="btnRandom">Random</button>
        <button id="btnGreedy">Greedy(Q)</button>
        <button id="btnOptimal">Optimal</button>

        <!-- <button id="recStart">Start Record</button>
        <button id="recStop" disabled>Stop & Download</button> -->

    </div>      

    <canvas id="canvas"></canvas>

    <script>
        math.shape = (x) => Array.isArray(math.size(x)) ? math.size(x) : math.size(x).valueOf();
        const assert = (cond, msg) => { if (!cond) throw new Error(msg); };
    </script>
    <script src="mdp.js"></script>
    <script src="render.js"></script>

    <script>
        let rec = null, recChunks = [];

        function startRecord() {
            const stream = canvas.captureStream(20); // 20 FPS 추천 (GIF면 15~20)
            recChunks = [];
            rec = new MediaRecorder(stream, { mimeType: 'video/webm;codecs=vp9' });
            rec.ondataavailable = e => e.data.size && recChunks.push(e.data);
            rec.onstop = () => {
                const blob = new Blob(recChunks, { type: 'video/webm' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = 'mdp.webm';
                document.body.appendChild(a); a.click(); a.remove();
                URL.revokeObjectURL(url);
            };
            rec.start();
            document.getElementById('recStart').disabled = true;
            document.getElementById('recStop').disabled = false;
        }

        function stopRecord() {
            if (rec && rec.state !== 'inactive') rec.stop();
            document.getElementById('recStart').disabled = false;
            document.getElementById('recStop').disabled = true;
        }

        document.getElementById('recStart')?.addEventListener('click', startRecord);
        document.getElementById('recStop')?.addEventListener('click', stopRecord);

    </script>
    </body>
    
    </html>

